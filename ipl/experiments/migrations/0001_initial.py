# Generated by Django 3.1.14 on 2024-09-23 11:24

import colorfield.fields
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import experiments.models
import filebrowser.fields
import tinymce.models
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='AnswerBase',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created', models.DateTimeField(auto_now_add=True)),
                ('updated', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='BlockItem',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('label', models.CharField(max_length=20)),
                ('comment', models.TextField(blank=True, null=True)),
                ('background_colour', colorfield.fields.ColorField(default='#FFFFFF', image_field=None, max_length=25, samples=None)),
                ('randomise_trials', models.BooleanField(default=False)),
                ('position', models.PositiveSmallIntegerField(null=True, verbose_name='Position')),
            ],
            options={
                'ordering': ['position'],
            },
        ),
        migrations.CreateModel(
            name='Experiment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('exp_name', models.CharField(max_length=200, verbose_name='experiment name')),
                ('created_on', models.DateTimeField(auto_now_add=True, verbose_name='date created')),
                ('sharing_option', models.CharField(choices=[('OWN', 'Only me'), ('GRP', 'Group members only'), ('PUB', 'Everyone')], default='OWN', max_length=3, verbose_name='sharing options')),
                ('list_selection_strategy', models.CharField(choices=[('LPF', 'Least played'), ('SEQ', 'Sequential'), ('RAN', 'Random')], default='LPF', max_length=3, verbose_name='list selection strategy')),
                ('include_pause_page', models.BooleanField(default=True, help_text='When global timeout is encountered / exit button is pressed, go to pause page instead of ending experiment immediately.')),
                ('loading_image', filebrowser.fields.FileBrowseField(blank=True, help_text='Shown at the end of the experiment, if media recordings are still being uploaded.', max_length=200)),
                ('show_gaze_estimations', models.BooleanField(default=False, help_text='Display webgazer estimations during experiment (for debugging purposes).')),
                ('recording_option', models.CharField(choices=[('NON', 'Key/Click responses only'), ('AUD', 'Audio + key/click responses'), ('VID', 'Video + key/click responses'), ('EYE', 'Eye-tracking + key/click responses'), ('ALL', 'Eye-tracking + video + key/click responses')], default='NON', max_length=3)),
                ('general_onset', models.IntegerField(default=0, verbose_name='wait to enable key/click response (ms)')),
                ('information_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n{% block title %}Online Study{% endblock %} \n\n{% block content %}\n<div class="container" id="information">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Online Study</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body text-justify">\n                    <p class="card-text">\n                        Dear parents,<br /><br />\n\n                        Welcome to the Online Study.<br /><br />\n\n                        If you wish to participate in this study with your child, please carefully go through the following information about the study:<br />\n                        - The aim of this study is to XXX.<br />\n                        - To be eligible to participate in this study, your child must be XXX years old.<br />\n                        - In order to evaluate this online study, we will require video recordings and these will be recorded using your computer\'s webcam. Thus, to participate, you must be using a computer or a laptop with a webcam and be ready to allow access to the webcam for recording. The videos are transmitted via a secure connection (TLS, 256-bit encryption) directly to the university\'s servers, where they are stored under the highest security standards. <br />\n                        - During the study, your child needs to be seated so that they can be properly seen on the webcam recording. <br />\n                        - Before starting, we will ask you a few questions and your personal data will be stored separately from the data and videos of the study. <br />\n                        - The study is only compatible with Firefox and Google Chrome browsers. Please use one of these browsers. <br />\n                        - You may withdraw from the study at any time without providing a reason. During the entire study, an “Exit” button will be visible at the bottom right corner of the screen. Click on this button if in any case you wish to terminate the study. <br />\n                        - You may also request for your data to be deleted at any time. To do so, please send an email to XXX and state the exact name you entered in the participant form which will be presented next. <br /><br />\n                        \n                        If you agree to participate in this study, please click on “Next” below. Before we begin, we will ask you a few more questions and carry out some technical checks. <br /><br />\n                        We look forward to your participation!\n\n                    </p>\n                    <form action="{% url \'experiments:browserCheck\' experiment.id %}" method="post">\n                        {% csrf_token %}\n                        <div class="text-center">\n                            <button type="submit" class="btn btn-primary" id="nextbutton">Next</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}', verbose_name='welcome page template')),
                ('browser_check_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% load static %} {% block title %}Browser compatibility check{% endblock %}\n{% block content %}\n<div class="container" id="information">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Browser compatibility check</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card active" id="webcam_step_1">\n                <!-- h4 class="card-header">Step 1</h4-->\n                <div class="card-body">\n                    <!--h4 class="card-title">Browser compatibility check</h4-->\n                    <p class="card-text">\n                        We will now check the compatibility of your browser. The study is only compatible with Firefox and Google Chrome. If the test fails, please restart the study using one of these browsers.\n                    </p>\n                    <div class="alert alert-success" role="alert" style="display: none;">\n                        You are using a compatible browser. Please continue.\n                    </div>\n                    <div class="alert alert-danger" role="alert" style="display: none;">\n                        You are using an incompatible browser. Please reopen the page in Google Chrome or Mozilla Firefox.\n                    </div>\n                    <form action="{% url \'experiments:consentForm\' experiment.id %}" method="post">\n                        {% csrf_token %}\n                        <button type="submit" disabled="disabled" class="btn btn-primary" id="nextbutton">Next</button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<script src="{% static \'experiments/js/browser-check.js\' %}"></script>\n{% endblock %}', verbose_name='browser check page template')),
                ('introduction_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% block title %}Consent form{% endblock %} {% block content %}\n<div class="container">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Consent form</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body">\n                    {% if error_message %}\n                    <div class="alert alert-danger" role="alert">\n                        {{ error_message }}\n                    </div>\n                    {% endif %}\n                    <form action="{% url \'experiments:consentFormSubmit\' experiment.id %}" method="post" novalidate>\n                        {% csrf_token %}\n                        <p class="card-text">\n                            Please read the following points carefully and indicate whether you agree to them.<br /><br />\n                            Participation in the study is only possible if you agree to each of the following points.\n                        </p>\n                        <p><br><span class="asterix">* Required</span></p>\n                        {% for field in consent_form %}\n                        <div class="q-item" value="{{ forloop.counter }}">\n                            <div class="field-wrapper question-required">\n                                {{ field.errors }}\n                                <label class="label-inline">{{ field.label }}<span class="asterix"> * </span></label>\n                                <div class="form-field-body">\n                                    {{ field }}\n                                </div>\n                            </div>\n                        </div><br>\n                        {% endfor %}\n                        <button type="submit" class="btn btn-primary">Next</button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}', verbose_name='consent form template')),
                ('consent_fail_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n{% block title %}Consent not granted{% endblock %} \n\n{% block content %}\n<div class="container" id="consentFail">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Consent not granted</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col text-center ">\n            <div class= "card-body alert alert-danger">\n                <p class="card-text">\n                        You did not agree to all points. Therefore, we are unable to proceed with the study.<br /><br />\n                        If you really do not agree, please close your browser window.<br /><br />\n                        If you wish to return to change your responses, please click "back".\n                </p>\n            </div>\n            <form action="{% url \'experiments:consentForm\' experiment.id %}" method="post">\n            {% csrf_token %}        \n                <button type="submit" class="btn btn-primary" id="resumebutton">Back</button>\n            </form>\n        </div>\n    </div>\n</div>\n{% endblock %}', verbose_name='consent failed page template')),
                ('demographic_data_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% block title %}Participant form{% endblock %} {% block content %}\n<div class="container">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Participant form</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body">\n                    {% if error_message %}\n                    <div class="alert alert-danger" role="alert">\n                        {{ error_message }}\n                    </div>{% endif %}\n\n                    <form id="subjectForm" action="{% url \'experiments:subjectFormSubmit\' experiment.id %}" method="post" novalidate>\n                        {% csrf_token %}\n                        <p class="card-text">\n                            Please fill out the fields below. You must fill out at least all fields marked with * in order to participate in the study.\n                        </p>\n                        <p><br><span class="asterix">* Required</span></p>\n                        {% for field in subject_data_form %}\n                        {% if field.name == \'resolution_w\' or field.name == \'resolution_h\' %}\n                            {{ field }}\n                        {% else %}\n                        <div class="q-item" value="{{ forloop.counter }}">\n                            {% if field.field.required %}\n                            <div class="field-wrapper question-required">\n                                {{ field.errors }}\n                                <label class="label-inline">{{ field.label }} <span class="asterix">*</span></label>\n                            {% else %}\n                            <div class="field-wrapper">\n                                {{ field.errors }}\n                                <label class="label-inline">{{ field.label }}</label>\n                            {% endif %}\n                                <div class="form-field-body">\n                                    {{ field }}\n                                </div>\n                                <small class="form-text text-muted">{{ field.help_text }}</small>\n                            </div>\n                        </div><br>\n                        {% endif %}\n                        {% endfor %}\n                        <!-- reCAPTCHA input -->\n                        <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response"> \n                        <button type="submit" class="btn btn-primary">Next</button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<!-- reCAPTCHA API -->\n<script src=\'https://www.google.com/recaptcha/api.js?render={{recaptcha_site_key}}\'></script>\n<script>\n    // global grecaptcha\n    grecaptcha.ready(function() {\n        $(\'#subjectForm\').submit(function(e){\n            var form = this;\n            e.preventDefault();\n            grecaptcha.execute(\'{{recaptcha_site_key}}\', {action: \'submit\'}).then(function(token) {\n                $(\'#g-recaptcha-response\').val(token);\n                form.submit();\n            });\n        });\n    });\n</script>\n{% endblock %}', verbose_name='demographic data page template')),
                ('cdi_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% block title %}Vocabulary checklist{% endblock %} {% block content %}\n<div class="container">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Vocabulary checklist</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body">\n                    {% if error_message %}\n                    <div class="alert alert-danger" role="alert">\n                        {{ error_message }}\n                    </div>\n                    {% endif %}\n\n                    <form id="cdiForm" action="{% url \'experiments:vocabChecklistSubmit\' subject_data.id %}" method="post" novalidate>\n                        {% csrf_token %}\n                        <p class="card-text">\n                            Please mark the box if your child understands the word. If your child uses another word with the same meaning (e.g., nana for grandma), mark it anyway. </br></br>\n                        </p>\n                        {{ cdi_form.non_field_errors }}\n                        {% for field in cdi_form %}\n                        {% if field.name == \'experiment\' %}\n                            {{ field }}\n                        {% else %}\n                        <div class="word-item" value="{{ forloop.counter }}">\n                            <div class="field-wrapper">\n                                {{ field.errors }}\n                                {{ field }} &emsp; <label class="label-inline">{{ field.label }}</label>\n                                    \n                                <small class="form-text text-muted">{{ field.help_text }}</small>\n                            </div>\n                        </div>\n                        <br>\n                        {% endif %}\n                        {% endfor %}\n                        <button type="submit" class="btn btn-primary">Submit</button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<script>\n    $(document).ready(function() {\n        $("#cdiForm").on(\'submit\', function() {\n            // to each unchecked checkbox\n            $(\'input:checkbox:not(:checked)\').each(function () {\n                // add hidden checkbox to be posted\n                $("#cdiForm").append("<input type=\'hidden\' name=\'" + this.name + "\' value=\'0\' />");\n            });\n        })\n    })\n</script>\n{% endblock %}', verbose_name='CDI page template')),
                ('webcam_check_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% load static %} {% block title %}Webcam and microphone setup{% endblock %} {% block content%}\n<div class="container" id="webcam-calibration" data-subject-uuid="{{ subject_data.id }}">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Webcam and microphone setup</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card active" id="webcam_step_2">\n                <div class="card-body">\n                    <p class="card-text">\n                        For this study it is necessary that you allow access to webcam and microphone.<br /><br />\n                        In the next step, your browser will ask you for permission to activate the webcam and microphone. Please click on "Allow" to continue with the study.<br /><br />\n                        If you are offered the option "always allow", please select this so that your browser saves the setting (only for our server). You can also only allow individual cases. Your browser will then ask for permission to activate the webcam and microphone several times in the next few steps.\n                    </p>\n                    <button type="button" class="btn btn-primary" disabled>Next</button>\n                </div>\n            </div>\n\n            <div class="card" id="webcam_step_3">\n                <div class="card-body">\n                    <p class="card-text">\n                        You will now see a window with the camera image below. Please adjust your camera so that your child is clearly visible.<br /><br />\n                        We are about to make a short test recording (about 3 seconds) to test whether the video recording works. As soon as you click on "Start test recording", the test recording starts. Please say something out loud (e.g. "hello") after clicking so that you can check the audio recording.\n                    </p>\n                    <div class="alert alert-danger" role="alert" style="display: none;"></div>\n                    <div class="embed-responsive" style="display: none;">\n                        <video controls class="embed-responsive-item"></video>\n                    </div>\n                    <button type="button" class="btn btn-primary" disabled>Start test recording</button>\n                    <button type="button" class="btn btn-warning" id="repeat-check-button" style="display: none;">Repeat test recording</button>\n                </div>\n            </div>\n\n            <div class="card" id="webcam_step_4">\n                <div class="card-body">\n                    <p class="card-text">\n                        Below is the sample video. Please play this and assess whether you and your child are clearly visible and whether the sound was recorded.<br /><br />\n                        Please make sure that the sound is activated on your computer.\n                    </p>\n                    <p class="card-text" id="upload-progress">\n                        <img src="{% static \'experiments/img/loading.gif\' %}" alt="Loading" title="Loading" />\n                    </p>\n                    <div class="alert alert-danger" role="alert" style="display: none;">\n                        The video upload failed.<br />\n                    </div>\n                    <div class="embed-responsive" style="display: none;">\n                    </div>\n                    <div class="alert alert-success" role="alert" style="display: none;">\n                        The video upload was successful. Please proceed with the study.\n                    </div>\n\n                    <button type="button" class="btn btn-primary" disabled data-target="{% url \'experiments:experimentRun\' subject_data.pk %}">Next (Image and sound were recorded.)</button>\n                    <button type="button" class="btn btn-warning" disabled data-toggle="modal" data-target="#repeatWebcamModal">Repeat test (There was a problem with the test recording.)</button>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<div class="modal fade" id="repeatWebcamModal" tabindex="-1" role="dialog" aria-labelledby="repeatWebcamModalLabel" aria-hidden="true">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="repeatWebcamModalLabel">Repeat test recording</h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n            </div>\n            <div class="modal-body">\n                If you could not hear any sound or see any image: Please make sure that your webcam and speakers are on and connected to your computer. Please also check that the volume is not turned down too low.\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-primary" id="repeatRutton">Repeat test</button>\n            </div>\n        </div>\n    </div>\n</div>\n\n<button id="exit-button" type="button" class="btn btn-secondary btn-sm">Exit</button>\n<script>\n    var webcam_not_found = `Unfortunately your webcam could not be detected.<br /><br />Please make sure a webcam is connected and click "Repeat test recording" to return to the webcam test.<br /><br />If you do not agree to allow access to your webcam and have therefore selected "do not allow", please close the browser window.`;\n    var include_pause_page = "{{ experiment.include_pause_page }}";\n    var recording_option = "{{ experiment.recording_option }}";\n</script>\n<script src="{% static \'experiments/js/webcam-calibration.js\' %}"></script>\n{% endblock %}', verbose_name='webcam check page template (ignore if not applicable)')),
                ('microphone_check_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% load static %} {% block title %}Microphone setup{% endblock %} {% block content%}\n<div class="container" id="webcam-calibration" data-subject-uuid="{{ subject_data.id }}">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Mirophone setup</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card active" id="webcam_step_2">\n                <div class="card-body">\n                    <p class="card-text">\n                        For this study it is necessary that you allow access to your microphone.<br /><br />\n                        In the next step, your browser will ask you for permission to activate the microphone. Please click on "Allow" to continue with the study. The test recording (about 3 seconds) begins right after you allow access to your microphone. Please say something out loud (e.g. "hello") so that you can check the audio recording. <br /><br />\n                        If you are offered the option "always allow", please select this so that your browser saves the setting (only for our server). You can also only allow individual cases. Then your browser will ask for permission to activate the microphone several times in the next few steps.\n                    </p>\n                    <button type="button" class="btn btn-primary" disabled>Next</button>\n                </div>\n            </div>\n\n            <div class="card" id="webcam_step_4">\n                <div class="card-body">\n                    <p class="card-text">\n                        Below is the sample audio. Please play this and assess whether sound was recorded.<br /><br />\n                        Please make sure that sound is activated on your computer.\n                    </p>\n                    <p class="card-text" id="upload-progress">\n                        <img src="{% static \'experiments/img/loading.gif\' %}" alt="Loading" title="Loading" />\n                    </p>\n                    <div class="alert alert-danger" role="alert" style="display: none;">\n                        The audio upload failed.<br />\n                    </div>\n                    <div class="embed-responsive" style="display: none;">\n                    </div>\n                    <div class="alert alert-success" role="alert" style="display: none;">\n                        The audio upload was successful, please continue.\n                    </div>\n\n                    <button type="button" class="btn btn-primary" disabled data-target="{% url \'experiments:experimentRun\' subject_data.pk %}">Next (Sound was recorded.)</button>\n                    <button type="button" class="btn btn-warning" disabled data-toggle="modal" data-target="#repeatWebcamModal">Repeat test recording (There was a problem with the test recording.)</button>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<div class="modal fade" id="repeatWebcamModal" tabindex="-1" role="dialog" aria-labelledby="repeatWebcamModalLabel" aria-hidden="true">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="repeatWebcamModalLabel">Repeat test recording</h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n            </div>\n            <div class="modal-body">\n                If you could not hear any sound: Please make sure that your speakers are on and connected to your computer. Please also check that the volume is not turned down too low.\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-primary" id="repeatRutton">Repeat test recording</button>\n            </div>\n        </div>\n    </div>\n</div>\n\n<button id="exit-button" type="button" class="btn btn-secondary btn-sm">Exit</button>\n<script>\n    var webcam_not_found = `Unfortunately your microphone could not be detected.<br /><br />Please make sure a microphone is connected and click "Repeat test recording" to return to the microphone test.<br /><br />If you do not agree to allow access to your microphone and have therefore selected "do not allow", please close the browser window.`;\n    var include_pause_page = "{{ experiment.include_pause_page }}";\n    var recording_option = "{{ experiment.recording_option }}";\n</script>\n<script src="{% static \'experiments/js/webcam-calibration.js\' %}"></script>\n{% endblock %}', verbose_name='microphone check page template (ignore if not applicable)')),
                ('experiment_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n\n{% block title %}Experiment{% endblock %} \n\n{% block content %}\n<div class="container h-100 text-center" id="fullscreen-message">\n    <div class="row h-100 justify-content-center align-items-center">\n        <div class="col">\n            <p class="card-text">\n                Almost set!<br /><br />\n                Before the study starts, we would like to record a short statement from you. Please read the text on the next page aloud with your child on your lap. <br /><br />\n                This repeated declaration is important to us because we really want to make sure that you have understood the framework conditions and agree with them. If we do not have this recording, we will delete your data and videos. <br /><br />\n                After the declaration, the study starts immediately. Please follow the instructions on the screen. <br />\n                The study is presented in full screen. If you want to exit or interrupt the study at any time, please click on "Exit" at the bottom right. <br /><br />\n                To proceed, please click "Activate full screen"\n            </p>\n            <button id="fullscreen-button" type="button" class="btn btn-primary" disabled>Activate full screen</button>\n        </div>\n    </div>\n</div>\n\n<button id="exit-button" type="button" class="btn btn-secondary btn-sm">Exit</button>\n<canvas id="plotting_canvas" style="display: none;" width="500" height="500"></canvas>\n<div class="container h-100 text-center" id="webgazer-init">\n    <div class="row h-100 justify-content-center align-items-center">\n        <div class="col">\n            <br /><br />\n            <p class="card-text">\n                Please position the head of your child in a way that makes its eyes clearly visible to the webcam. <br />\n                The head should also be positioned in the middle of the rectangle presented.<br />\n                As the experiment works best with a steady head, make sure that your child has a comfortable seating position.<br />\n                As soon as the face is centered and the rectangle turns green, you can press the "Start" button to begin. <br />\n            </p>\n            <button type="button" class="btn btn-primary" disabled>Start</button>\n        </div>\n    </div>\n</div>\n\n<div id="trials" style="display: none;" data-subject-uuid="{{ subject_data.id }}" data-subject-id="{{ subject_data.participant_id }}"></div>\n\n<div id="exitStudyModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exitStudyModalLabel" aria-hidden="true">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 id="exitStudyModalLabel" class="modal-title">Terminate the study</h5>\n                <button class="close" type="button" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>\n            </div>\n            <div class="modal-body">\n                Media recordings are still being uploaded. If you quit the study now, these recordings will be lost. Are you sure you want to quit?\n            </div>\n            <div class="modal-footer">\n                <button id="confirmExitButton" class="btn btn-danger" type="button">Quit</button> \n                <button class="btn btn-primary" type="button" data-dismiss="modal">Return to study</button>\n            </div>\n        </div>\n    </div>\n</div>\n<script>\n    var trials = {{ trials|safe }}\n    var loading_image = "{{ loading_image.url }}";\n    var global_timeout = "{{ global_timeout }}";\n    var include_pause_page = "{{ include_pause_page }}";\n    var recording_option = "{{ recording_option }}";\n    var general_onset = "{{ general_onset }}";\n    var show_gaze_estimations = "{{ show_gaze_estimations }}";\n</script>\n \n<script src="{% static \'experiments/js/experiment.js\' %}"></script>\n<script src="{% static \'experiments/js/webgazer.min.js\' %}"></script>\n<script src="{% static \'experiments/js/webgazer-calibration.js\' %}"></script>\n{% endblock %}\n', verbose_name='experiment page template')),
                ('pause_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n{% block title %}Pause{% endblock %} \n\n{% block content %}\n<div class="container" id="pause">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Pause</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body text-center">\n                    <p>\n                        The study is paused and the recording stopped.<br /><br />\n                        If you wish to terminate the study, please click "Exit study" below. <br /><br />\n                        To continue, please click "Resume study". You will then be taken back to the point in the study where you paused.\n                    </p>\n                    <div id="side-by-side-left"> \n                        <form action="{% url \'experiments:webcamTest\' subject_id %}" method="post">\n                            {% csrf_token %}        \n                            <button type="submit" class="btn btn-primary" id="resumebutton">Resume study</button>\n                        </form>\n                    </div>\n                    <div id="side-by-side-right"> \n                        <form action="{% url \'experiments:experimentEnd\' subject_id %}" method="post">\n                            {% csrf_token %}        \n                            <button type="submit" class="btn btn-danger" id="exitbutton">Exit study</button>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}', verbose_name='pause page template')),
                ('thank_you_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n{% block title %}Thank you{% endblock %} \n\n{% block content %}\n<div class="container" id="thank-you">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Thank you</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card active" id="end_page_step_1">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        You have reached the end of the study. Please click "Approve processing and use of data" to confirm your participation in the study. If you wish to withdraw from the study, please click "Remove all my data".<br /><br />\n                    </p>\n                    <div id="side-by-side-left"> \n                        <button type="button" class="btn btn-primary" id="approve-data-button">Approve processing and use of data</button>\n                    </div>\n                    <div id="side-by-side-right"> \n                        <form action="{% url \'experiments:deleteSubject\' subject_id %}" method="post">\n                            {% csrf_token %}        \n                            <button type="submit" class="btn btn-danger" id="delete-data-button">Remove all my data</button>\n                        </form>\n                    </div>\n                </div>\n            </div>\n            <div class="card" id="end_page_approve">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        Thank you for your participation!<br /><br />\n                        You may now close your browser window.\n                    </p>\n                </div>\n            </div>\n            <div class="card" id="end_page_disapprove">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        All of your data has been deleted.<br /><br />\n                        You may now close your browser window.\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src="{% static \'experiments/js/endpage.js\' %}"></script>\n{% endblock %}', verbose_name='standard end page template')),
                ('thank_you_abort_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} \n{% load static %}\n{% block title %}Study incomplete{% endblock %} \n\n{% block content %}\n<div class="container" id="thank-you">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Study incomplete</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card active" id="end_page_step_1">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        It is a pity that you aborted the study. The recording has ended. You may now close the browser window.<br /><br />\n                        We would like to know why you aborted the study. If you wish to tell us about this, please send an email to XXX.\n                    </p>\n                    <div id="side-by-side-left"> \n                        <button type="button" class="btn btn-primary" id="approve-data-button">Approve processing and use of data</button>\n                    </div>\n                    <div id="side-by-side-right"> \n                        <form action="{% url \'experiments:deleteSubject\' subject_id %}" method="post">\n                            {% csrf_token %}        \n                            <button type="submit" class="btn btn-danger" id="delete-data-button">Remove all my data</button>\n                        </form>\n                    </div>\n                </div>\n            </div>\n            <div class="card" id="end_page_approve">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        Thank you for your participation!<br /><br />\n                        You may now close your browser window.\n                    </p>\n                </div>\n            </div>\n            <div class="card" id="end_page_disapprove">\n                <div class="card-body text-center">\n                    <p class="card-text">\n                        All of your data has been deleted.<br /><br />\n                        You may now close your browser window.\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src="{% static \'experiments/js/endpage.js\' %}"></script>\n{% endblock %}', verbose_name='end page after discontinuation template')),
                ('error_page_tpl', tinymce.models.HTMLField(default='{% extends "experiments/base.html" %} {% block title %}Error{% endblock %} {% block content %}\n<div class="container" id="information">\n    <div class="row">\n        <div class="col text-center">\n            <h1>Error</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-body text-justify">\n                    <p class="card-text">\n                        An error has occurred. The study has now terminated.\n                    </p>\n                    <div class="alert alert-danger" role="alert">\n                        Error message\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}', verbose_name='error page template')),
                ('assess_type', models.CharField(choices=[('COMP', 'Comprehension'), ('PROD', 'Production')], default='COMP', max_length=4, verbose_name='assessment type')),
                ('num_words', models.IntegerField(default=25, verbose_name='vocabulary checklist length')),
                ('typical_dev', models.BooleanField(default=True, help_text='Uncheck this box if experiment involves non-typically developing children.', verbose_name='for typically-developing children')),
            ],
        ),
        migrations.CreateModel(
            name='Instrument',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('instr_name', models.CharField(max_length=200, verbose_name='instrument name')),
                ('words_list', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250)),
                ('irt_params', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='IRT parameters')),
                ('f_lm_np_mean', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='NP: M (female)')),
                ('f_lm_np_sd', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='NP: SD (female)')),
                ('f_lm_p_mean', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='P: M (female)')),
                ('f_lm_p_sd', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='P: SD (female)')),
                ('f_bmin', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='BMin (female)')),
                ('f_slope', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='Slope (female)')),
                ('m_lm_np_mean', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='NP: M (male)')),
                ('m_lm_np_sd', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='NP: SD (male)')),
                ('m_lm_p_mean', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='P: M (male)')),
                ('m_lm_p_sd', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='P: SD (male)')),
                ('m_bmin', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='BMin (male)')),
                ('m_slope', filebrowser.fields.FileBrowseField(help_text='Only .csv files are supported.', max_length=250, verbose_name='Slope (male)')),
            ],
        ),
        migrations.CreateModel(
            name='ListItem',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('list_name', models.CharField(max_length=20)),
                ('global_timeout', models.IntegerField(default=300000, verbose_name='global timeout (ms)')),
                ('exclude_list', models.BooleanField(default=False, verbose_name='do not include this list')),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.experiment')),
            ],
        ),
        migrations.CreateModel(
            name='SubjectData',
            fields=[
                ('id', models.CharField(max_length=36, primary_key=True, serialize=False, verbose_name='Unique ID')),
                ('participant_id', models.IntegerField(blank=True, null=True, verbose_name='Participant Number')),
                ('cdi_estimate', models.FloatField(blank=True, default=None, null=True)),
                ('created', models.DateTimeField(auto_now_add=True)),
                ('updated', models.DateTimeField(auto_now=True)),
                ('resolution_w', models.IntegerField(default=0, verbose_name='Resolution Width')),
                ('resolution_h', models.IntegerField(default=0, verbose_name='Resolution Height')),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='experiments.experiment')),
                ('listitem', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='experiments.listitem')),
            ],
            options={
                'verbose_name': 'Participant data',
                'verbose_name_plural': 'Participant data',
            },
        ),
        migrations.CreateModel(
            name='TrialItem',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('label', models.CharField(max_length=20)),
                ('code', models.CharField(max_length=20)),
                ('visual_onset', models.IntegerField(default=0, verbose_name='visual onset (ms)')),
                ('audio_onset', models.IntegerField(default=0, verbose_name='audio onset (ms)')),
                ('audio_file', filebrowser.fields.FileBrowseField(blank=True, max_length=200)),
                ('visual_file', filebrowser.fields.FileBrowseField(max_length=200)),
                ('user_input', models.CharField(choices=[('NO', 'Do not require user input'), ('YES', 'Require user input')], default='NO', max_length=3)),
                ('response_keys', models.CharField(blank=True, help_text='Provide a comma-separated list if multiple response keys are allowed (e.g., click, up, down, left, right, a, b).', max_length=200, null=True, verbose_name='response key(s)')),
                ('max_duration', models.IntegerField(help_text='This value will be ignored for video trials which do not require user input.', verbose_name='maximum duration (ms)')),
                ('record_media', models.BooleanField(default=True, help_text='This value will be ignored if the experiment is set to record key/click responses only.')),
                ('record_gaze', models.BooleanField(default=True, help_text='This value will be ignored if the experiment is not set to record eye-tracking data.', verbose_name='enable eye-tracking')),
                ('is_calibration', models.BooleanField(default=False, help_text='This value will be ignored if the experiment is not set to record eye-tracking data.', verbose_name='calibrate eye-tracker')),
                ('calibration_points', models.JSONField(default=experiments.models.default_calibration_points, help_text='These values will be ignored if "calibrate eye-tracker" is unchecked and the experiment is not set to record eye-tracking data.<br/>The duration for which each calibration point is shown is determined by dividing the <em>maximum duration</em> with the number of calibration points.')),
                ('grid_row', models.IntegerField(default=1, verbose_name='rows')),
                ('grid_col', models.IntegerField(default=1, verbose_name='columns')),
                ('position', models.PositiveSmallIntegerField(null=True, verbose_name='Position')),
                ('blockitem', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.blockitem')),
            ],
            options={
                'ordering': ['position'],
            },
        ),
        migrations.CreateModel(
            name='AnswerInteger',
            fields=[
                ('answerbase_ptr', models.OneToOneField(auto_created=True, on_delete=django.db.models.deletion.CASCADE, parent_link=True, primary_key=True, serialize=False, to='experiments.answerbase')),
                ('body', models.IntegerField(blank=True, null=True)),
            ],
            bases=('experiments.answerbase',),
        ),
        migrations.CreateModel(
            name='AnswerRadio',
            fields=[
                ('answerbase_ptr', models.OneToOneField(auto_created=True, on_delete=django.db.models.deletion.CASCADE, parent_link=True, primary_key=True, serialize=False, to='experiments.answerbase')),
                ('body', models.TextField(blank=True, null=True)),
            ],
            bases=('experiments.answerbase',),
        ),
        migrations.CreateModel(
            name='AnswerSelect',
            fields=[
                ('answerbase_ptr', models.OneToOneField(auto_created=True, on_delete=django.db.models.deletion.CASCADE, parent_link=True, primary_key=True, serialize=False, to='experiments.answerbase')),
                ('body', models.TextField(blank=True, null=True)),
            ],
            bases=('experiments.answerbase',),
        ),
        migrations.CreateModel(
            name='AnswerSelectMultiple',
            fields=[
                ('answerbase_ptr', models.OneToOneField(auto_created=True, on_delete=django.db.models.deletion.CASCADE, parent_link=True, primary_key=True, serialize=False, to='experiments.answerbase')),
                ('body', models.TextField(blank=True, null=True)),
            ],
            bases=('experiments.answerbase',),
        ),
        migrations.CreateModel(
            name='AnswerText',
            fields=[
                ('answerbase_ptr', models.OneToOneField(auto_created=True, on_delete=django.db.models.deletion.CASCADE, parent_link=True, primary_key=True, serialize=False, to='experiments.answerbase')),
                ('body', models.TextField(blank=True, null=True)),
            ],
            bases=('experiments.answerbase',),
        ),
        migrations.CreateModel(
            name='TrialResult',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(auto_now_add=True)),
                ('start_time', models.FloatField(blank=True, null=True)),
                ('end_time', models.FloatField(blank=True, null=True)),
                ('key_pressed', models.CharField(blank=True, max_length=255, null=True)),
                ('webcam_file', models.FileField(blank=True, null=True, upload_to=experiments.models.visual_folder)),
                ('trial_number', models.IntegerField(default=0)),
                ('resolution_w', models.IntegerField(default=0, verbose_name='Resolution width')),
                ('resolution_h', models.IntegerField(default=0, verbose_name='Resolution height')),
                ('webgazer_data', models.JSONField(blank=True, default=list)),
                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.subjectdata')),
                ('trialitem', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='experiments.trialitem')),
            ],
        ),
        migrations.CreateModel(
            name='Question',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.TextField()),
                ('required', models.BooleanField()),
                ('question_type', models.CharField(choices=[('text', 'text'), ('radio', 'radio'), ('select', 'select'), ('select-multiple', 'select multiple'), ('integer', 'integer'), ('number-range', 'integer range'), ('age', 'age'), ('sex', 'sex')], default='text', max_length=200)),
                ('choices', models.TextField(blank=True, help_text='For types "radio", "select", and "select multiple", provide a comma-separated list of options (e.g., a, b, c). For type "integer range", provide the min and max integers (e.g., 1, 10) for range check. For type "age", provide the min and max integers (in months) for age check (e.g., 12, 36 - for limiting participation to 1-to-3-year-olds). For type "sex", provide the female followed by the male display text (e.g., female, male).', null=True)),
                ('position', models.PositiveSmallIntegerField(null=True, verbose_name='Position')),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.experiment')),
            ],
            options={
                'ordering': ['position'],
            },
        ),
        migrations.CreateModel(
            name='OuterBlockItem',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('outer_block_name', models.CharField(max_length=20)),
                ('position', models.PositiveSmallIntegerField(null=True, verbose_name='Position')),
                ('randomise_inner_blocks', models.BooleanField(default=False)),
                ('listitem', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.listitem')),
            ],
            options={
                'ordering': ['position'],
            },
        ),
        migrations.AddField(
            model_name='experiment',
            name='instrument',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='experiments.instrument'),
        ),
        migrations.AddField(
            model_name='experiment',
            name='sharing_groups',
            field=models.ManyToManyField(blank=True, to='auth.Group'),
        ),
        migrations.AddField(
            model_name='experiment',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='ConsentQuestion',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.TextField()),
                ('position', models.PositiveSmallIntegerField(null=True, verbose_name='Position')),
                ('response_yes', models.CharField(default='Yes', max_length=50, verbose_name='yes')),
                ('response_no', models.CharField(default='No', max_length=50, verbose_name='no')),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.experiment')),
            ],
            options={
                'ordering': ['position'],
            },
        ),
        migrations.CreateModel(
            name='CdiResult',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('given_label', models.CharField(blank=True, max_length=255, null=True, verbose_name='item')),
                ('response', models.BooleanField(blank=True, null=True)),
                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.subjectdata')),
            ],
        ),
        migrations.AddField(
            model_name='blockitem',
            name='outerblockitem',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.outerblockitem'),
        ),
        migrations.AddField(
            model_name='answerbase',
            name='question',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='experiments.question'),
        ),
        migrations.AddField(
            model_name='answerbase',
            name='subject_data',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='experiments.subjectdata'),
        ),
    ]
